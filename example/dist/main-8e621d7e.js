!function(){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function e(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function t(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function o(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?t(Object(r),!0).forEach(function(e){var t,n;t=i,e=r[n=e],n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})}return i}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function r(e,t){if(null==e)return{};var n,i=function(e,t){if(null==e)return{};for(var n,i={},r=Object.keys(e),s=0;s<r.length;s++)n=r[s],0<=t.indexOf(n)||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols)for(var r=Object.getOwnPropertySymbols(e),s=0;s<r.length;s++)n=r[s],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n]);return i}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=h(n);return e=i?(e=h(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!=typeof e&&"function"!=typeof e?l(t):e}}function c(e,t,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(n):t.value}})(e,t,n||e)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}(e,t)||g(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||g(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function v(i,r){return Object.entries(i).reduce(function(e,t){var n=d(t,2),t=n[0],n=n[1];return"object"===s(n)&&null!==n?r&&r[t]?e[t]=v(i[t],r[t]):e[t]=i[t]:e[t]=r&&r[t]||i[t],e},{})}function p(e){return"number"==typeof e}var m={styles:{timeGrid:{color:"rgba(90,90,90,0.20)"}}},E=function(){function n(e,t){y(this,n),this.renderEngine=e,this.start=0,this.end=0,this.accuracy=0,this.delta=0,this.setSettings(t)}return e(n,[{key:"setSettings",value:function(e){e=v(m,e);this.styles=e.styles.timeGrid,this.timeUnits=this.renderEngine.getTimeUnits()}},{key:"recalc",value:function(){var e=this.renderEngine.max-this.renderEngine.min,t=e/(this.renderEngine.width/85),n=this.renderEngine.getRealView(),e=n/(e||1);this.delta=t/Math.pow(2,Math.floor(Math.log2(1/e))),this.start=Math.floor((this.renderEngine.positionX-this.renderEngine.min)/this.delta),this.end=Math.ceil(n/this.delta)+this.start,this.accuracy=this.calcNumberFix()}},{key:"calcNumberFix",value:function(){var e=(this.delta/2).toString();if(e.includes("e"))return e.match(/\d+$/)[0];e=e.match(/(0\.0*)/);return e?e[0].length-1:0}},{key:"getTimelineAccuracy",value:function(){return this.accuracy}},{key:"forEachTime",value:function(e){for(var t=this.start;t<=this.end;t++){var n=t*this.delta+this.renderEngine.min;e(this.renderEngine.timeToPosition(n.toFixed(this.accuracy)),n)}}},{key:"renderLines",value:function(t,n){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.renderEngine;i.setCtxColor(this.styles.color),this.forEachTime(function(e){i.fillRect(e,t,1,n)})}},{key:"renderTimes",value:function(){var n=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.renderEngine;i.setCtxColor(i.styles.fontColor),i.setCtxFont(i.styles.font),this.forEachTime(function(e,t){i.fillText(t.toFixed(n.accuracy)+n.timeUnits,e+i.blockPaddingLeftRight,i.charHeight)})}}]),n}();function k(){}function x(){x.init.call(this)}function w(e){return void 0===e._maxListeners?x.defaultMaxListeners:e._maxListeners}function R(e,t,n,i){var r,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');return(r=e._events)?(r.newListener&&(e.emit("newListener",t,n.listener||n),r=e._events),s=r[t]):(r=e._events=new k,e._eventsCount=0),s?("function"==typeof s?s=r[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),s.warned||(i=w(e))&&0<i&&s.length>i&&(s.warned=!0,(i=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",i.emitter=e,i.type=t,i.count=s.length,i=i,"function"==typeof console.warn?console.warn(i):console.log(i))):(s=r[t]=n,++e._eventsCount),e}function M(e,t,n){var i=!1;function r(){e.removeListener(t,r),i||(i=!0,n.apply(e,arguments))}return r.listener=n,r}function C(e){var t=this._events;if(t){e=t[e];if("function"==typeof e)return 1;if(e)return e.length}return 0}function S(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function P(e,n){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;e.forEach(function(e){var t=n(e,i,r);e.children&&P(e.children,n,t||e,r+1)})}function T(e){var i=[],r=0;return P(e,function(e,t,n){n=o(o({},e),{},{end:e.start+e.duration,parent:t,level:n,index:r++});return i.push(n),n}),i.sort(function(e,t){return e.level-t.level||e.start-t.start})}function L(e){var n=!0,i=0,r=0;return e.forEach(function(e){var t=e.start,e=e.end;n?(i=t,r=e,n=!1):(i=i<t?i:t,r=e<r?r:e)}),{min:i,max:r}}function z(e,t,n){return e.start<n&&e.end>t||e.start>t&&e.end<n}function O(e,t){return e.color===t.color&&e.type===t.type}function A(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:O;return e.reduce(function(e,t){var n=e[e.length-1],i=n&&n[n.length-1];return i&&i.level===t.level&&r(i,t)?n.push(t):e.push([t]),e},[]).filter(function(e){return e.length}).map(function(e){return{nodes:e,parents:b(new Set(e.map(function(e){return e.parent})))}})}function j(e,r,s,o){var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.25,h=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1,l=null,u=null,c=0;return e.reduce(function(e,t){t=t.nodes;u=l=null,c=0;var n=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=g(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,t=function(){};return{s:t,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw r}}}}(t);try{for(n.s();!(i=n.n()).done;){var i=i.value;z(i,s,o)&&(l&&!u||u&&(i.start-(u.start+u.duration))*r<a&&i.duration*r<h&&u.duration*r<h?(l[c]=i,c++):(l=[i],c=1,e.push(l)),u=i)}}catch(e){n.e(e)}finally{n.f()}return e},[]).map(function(e){var t,n,i=e[0],n=(n=(t=e)[0],(t=t[t.length-1]).start+t.duration-n.start);return{start:i.start,end:i.start+n,duration:n,type:i.type,color:i.color,level:i.level,nodes:e}})}function H(e,n,i,r,s,o){return e.reduce(function(e,t){return z(t,i,r)&&(t.duration*n<=2.25?e.push(t):e.push.apply(e,b(j([t],n,i,r,s,o)))),e},[])}k.prototype=Object.create(null),(x.EventEmitter=x).usingDomains=!1,x.prototype.domain=void 0,x.prototype._events=void 0,x.prototype._maxListeners=void 0,x.defaultMaxListeners=10,x.init=function(){this.domain=null,x.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new k,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},x.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},x.prototype.getMaxListeners=function(){return w(this)},x.prototype.emit=function(e){var t,n,i,r="error"===e,s=this._events;if(s)r=r&&null==s.error;else if(!r)return!1;if(o=this.domain,r){if(r=arguments[1],o)return(r=r||new Error('Uncaught, unspecified "error" event')).domainEmitter=this,r.domain=o,r.domainThrown=!1,o.emit("error",r),!1;if(r instanceof Error)throw r;var o=new Error('Uncaught, unspecified "error" event. ('+r+")");throw o.context=r,o}if(!(t=s[e]))return!1;var a,h="function"==typeof t;switch(a=arguments.length){case 1:!function(e,t){if(h)e.call(t);else for(var n=e.length,i=S(e,n),r=0;r<n;++r)i[r].call(t)}(t,this);break;case 2:!function(e,t,n,i){if(t)e.call(n,i);else for(var r=e.length,s=S(e,r),o=0;o<r;++o)s[o].call(n,i)}(t,h,this,arguments[1]);break;case 3:!function(e,t,n,i,r){if(t)e.call(n,i,r);else for(var s=e.length,o=S(e,s),a=0;a<s;++a)o[a].call(n,i,r)}(t,h,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,i,r,s){if(t)e.call(n,i,r,s);else for(var o=e.length,a=S(e,o),h=0;h<o;++h)a[h].call(n,i,r,s)}(t,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(a-1),i=1;i<a;i++)n[i-1]=arguments[i];!function(e,t,n){if(h)e.apply(t,n);else for(var i=e.length,r=S(e,i),s=0;s<i;++s)r[s].apply(t,n)}(t,this,n)}return!0},x.prototype.addListener=function(e,t){return R(this,e,t,!1)},x.prototype.on=x.prototype.addListener,x.prototype.prependListener=function(e,t){return R(this,e,t,!0)},x.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,M(this,e,t)),this},x.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,M(this,e,t)),this},x.prototype.removeListener=function(e,t){var n,i,r,s,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new k:(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,s=n.length;0<s--;)if(n[s]===t||n[s].listener&&n[s].listener===t){o=n[s].listener,r=s;break}if(r<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new k,this;delete i[e]}else!function(e){for(var t=r,n=t+1,i=e.length;n<i;t+=1,n+=1)e[t]=e[n];e.pop()}(n);i.removeListener&&this.emit("removeListener",e,o||t)}return this},x.prototype.removeAllListeners=function(e){var t,n=this._events;if(!n)return this;if(!n.removeListener)return 0===arguments.length?(this._events=new k,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new k:delete n[e]),this;if(0===arguments.length){for(var i,r=Object.keys(n),s=0;s<r.length;++s)"removeListener"!==(i=r[s])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new k,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(;this.removeListener(e,t[t.length-1]),t[0];);return this},x.prototype.listeners=function(e){var t=this._events,n=t&&(n=t[e])?"function"==typeof n?[n.listener||n]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(n):[];return n},x.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):C.call(e,t)},x.prototype.listenerCount=C,x.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]};var F="QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm1234567890_-+()[]{}\\/|'\";:.,?~",D=function(e){return(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)},I={timeUnits:"ms",styles:{main:{blockHeight:16,blockPaddingLeftRight:4,backgroundColor:"white",font:"10px sans-serif",fontColor:"black",tooltipHeaderFontColor:"black",tooltipBodyFontColor:"#688f45",tooltipBackgroundColor:"white",headerHeight:14,headerColor:"rgba(112, 112, 112, 0.25)",headerStrokeColor:"rgba(112, 112, 112, 0.5)",headerTitleLeftPadding:16}}},X=function(){a(r,x);var i=u(r);function r(e,t){var n;return y(this,r),(n=i.call(this)).width=e.width,n.height=e.height,n.canvas=e,n.ctx=e.getContext("2d",{alpha:!1}),n.pixelRatio=D(n.ctx),n.setSettings(t),n.applyCanvasSize(),n.reset(),n}return e(r,[{key:"setSettings",value:function(e){var t=v(I,e);this.settings=t,this.timeUnits=t.timeUnits,this.styles=t.styles.main,this.blockHeight=this.styles.blockHeight,this.ctx.font=this.styles.font;var n=this.ctx.measureText(F),i=n.actualBoundingBoxAscent,e=n.actualBoundingBoxDescent,t=n.width,n=this.ctx.measureText("…").width,e=i+e;this.blockPaddingLeftRight=this.styles.blockPaddingLeftRight,this.blockPaddingTopBottom=Math.ceil((this.blockHeight-e)/2),this.charHeight=e+1,this.placeholderWidth=n,this.avgCharWidth=t/F.length,this.minTextWidth=this.avgCharWidth+this.placeholderWidth}},{key:"reset",value:function(){this.textRenderQueue=[],this.strokeRenderQueue=[],this.rectRenderQueue={}}},{key:"setCtxColor",value:function(e){e&&this.lastUsedColor!==e&&(this.ctx.fillStyle=e,this.lastUsedColor=e)}},{key:"setStrokeColor",value:function(e){e&&this.lastUsedStrokeColor!==e&&(this.ctx.strokeStyle=e,this.lastUsedStrokeColor=e)}},{key:"setCtxFont",value:function(e){e&&this.ctx.font!==e&&(this.ctx.font=e)}},{key:"fillRect",value:function(e,t,n,i){this.ctx.fillRect(e,t,n,i)}},{key:"fillText",value:function(e,t,n){this.ctx.fillText(e,t,n)}},{key:"renderBlock",value:function(e,t,n,i){this.setCtxColor(e),this.ctx.fillRect(t,n,i,this.blockHeight)}},{key:"renderStroke",value:function(e,t,n,i,r){this.setStrokeColor(e),this.ctx.setLineDash([]),this.ctx.strokeRect(t,n,i,r)}},{key:"clear",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.width,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.height,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;this.ctx.clearRect(n,i,e,t-1),this.setCtxColor(this.styles.backgroundColor),this.ctx.fillRect(n,i,e,t),this.emit("clear")}},{key:"timeToPosition",value:function(e){return e*this.zoom-this.positionX*this.zoom}},{key:"pixelToTime",value:function(e){return e/this.zoom}},{key:"setZoom",value:function(e){this.zoom=e}},{key:"setPositionX",value:function(e){var t=this.positionX;return(this.positionX=e)-t}},{key:"addRectToRenderQueue",value:function(e,t,n,i){this.rectRenderQueue[e]||(this.rectRenderQueue[e]=[]),this.rectRenderQueue[e].push({x:t,y:n,w:i})}},{key:"addTextToRenderQueue",value:function(e,t,n,i){var r;!e||0<(r=i-(2*this.blockPaddingLeftRight-(t<0?t:0)))&&this.textRenderQueue.push({text:e,x:t,y:n,w:i,textMaxWidth:r})}},{key:"addStrokeToRenderQueue",value:function(e,t,n,i,r){this.strokeRenderQueue.push({color:e,x:t,y:n,w:i,h:r})}},{key:"resolveRectRenderQueue",value:function(){var r=this;Object.entries(this.rectRenderQueue).forEach(function(e){var e=d(e,2),i=e[0],e=e[1];r.setCtxColor(i),e.forEach(function(e){var t=e.x,n=e.y,e=e.w;return r.renderBlock(i,t,n,e)})}),this.rectRenderQueue={}}},{key:"resolveTextRenderQueue",value:function(){var s=this;this.setCtxColor(this.styles.fontColor),this.textRenderQueue.forEach(function(e){var t=e.text,n=e.x,i=e.y;e.w;var r=e.textMaxWidth,e=s.ctx.measureText(t).width;r<e&&(e=e/t.length,t=0<(e=(Math.floor((r-s.placeholderWidth)/e)-1)/2)?t.slice(0,Math.ceil(e))+"…"+t.slice(t.length-Math.floor(e),t.length):""),t&&s.ctx.fillText(t,(n<0?0:n)+s.blockPaddingLeftRight,i+s.blockHeight-s.blockPaddingTopBottom)}),this.textRenderQueue=[]}},{key:"resolveStrokeRenderQueue",value:function(){var s=this;this.strokeRenderQueue.forEach(function(e){var t=e.color,n=e.x,i=e.y,r=e.w,e=e.h;s.renderStroke(t,n,i,r,e)}),this.strokeRenderQueue=[]}},{key:"setMinMax",value:function(e,t){var n=e!==this.min||t!==this.max;this.min=e,this.max=t,n&&this.emit("min-max-change",e,t)}},{key:"getTimeUnits",value:function(){return this.timeUnits}},{key:"tryToChangePosition",value:function(e){var t=this.getRealView();this.positionX+e+t<=this.max&&this.positionX+e>=this.min?this.setPositionX(this.positionX+e):this.positionX+e<=this.min?this.setPositionX(this.min):this.positionX+e+t>=this.max&&this.setPositionX(this.max-t)}},{key:"getInitialZoom",value:function(){return 0<this.max-this.min?this.width/(this.max-this.min):1}},{key:"getRealView",value:function(){return this.width/this.zoom}},{key:"resetView",value:function(){this.setZoom(this.getInitialZoom()),this.setPositionX(this.min)}},{key:"resize",value:function(e,t){var n="number"==typeof e&&this.width!==e,i="number"==typeof t&&this.height!==t;if(n||i)return this.width=n?e:this.width,this.height=i?t:this.height,this.applyCanvasSize(),this.emit("resize",{width:this.width,height:this.height}),i}},{key:"applyCanvasSize",value:function(){this.canvas.style.backgroundColor="white",this.canvas.style.overflow="hidden",this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,this.ctx.setTransform(this.pixelRatio,0,0,this.pixelRatio,0,0),this.ctx.font=this.styles.font,this.lastUsedColor=null,this.lastUsedStrokeColor=null}},{key:"copy",value:function(e){this.ctx.drawImage(e.canvas,0,0,e.canvas.width*e.pixelRatio,e.canvas.height*e.pixelRatio,0,e.position||0,e.width*e.pixelRatio,e.height*e.pixelRatio)}},{key:"renderTooltipFromData",value:function(e,t){var i=this,r=t.x+10,s=t.y+10,t=e.map(function(e){return e.text}).map(function(e){return i.ctx.measureText(e)}).reduce(function(e,t){t=t.width;return Math.max(e,t)},0)+2*this.blockPaddingLeftRight;this.ctx.shadowColor="black",this.ctx.shadowBlur=5,this.setCtxColor(this.styles.tooltipBackgroundColor),this.ctx.fillRect(r,s,t+2*this.blockPaddingLeftRight,(this.charHeight+2)*e.length+2*this.blockPaddingLeftRight),this.ctx.shadowColor=null,this.ctx.shadowBlur=null,e.forEach(function(e,t){var n=e.text,e=e.color;e?i.setCtxColor(e):t?i.setCtxColor(i.styles.tooltipBodyFontColor):i.setCtxColor(i.styles.tooltipHeaderFontColor),i.ctx.fillText(n,r+i.blockPaddingLeftRight,s+i.blockHeight-i.blockPaddingTopBottom+(i.charHeight+2)*t)})}},{key:"renderShape",value:function(e,t,n,i){var r=this;this.setCtxColor(e),this.ctx.beginPath(),this.ctx.moveTo(t[0].x+n,t[0].y+i),t.slice(1).forEach(function(e){var t=e.x,e=e.y;return r.ctx.lineTo(t+n,e+i)}),this.ctx.closePath(),this.ctx.fill()}},{key:"renderTriangle",value:function(e,t,n,i,r,s){var o,a=r/2,h=i/2;switch(s){case"top":o=[{x:0-h,y:a},{x:0,y:0-a},{x:h,y:a}];break;case"right":o=[{x:0-a,y:0-h},{x:0-a,y:h},{x:a,y:0}];break;case"bottom":o=[{x:0-h,y:0-a},{x:h,y:0-a},{x:0,y:a}];break;case"left":o=[{x:a,y:0-h},{x:a,y:h},{x:0-a,y:0}]}this.renderShape(e,o,t,n)}},{key:"renderCircle",value:function(e,t,n,i){this.ctx.beginPath(),this.ctx.arc(t,n,i,0,2*Math.PI,!1),this.setCtxColor(e),this.ctx.fill()}}]),r}(),G=function(){a(o,X);var s=u(o);function o(e){var t=e.width,n=e.height,i=e.parent,r=e.id;y(this,o);var e=document.createElement("canvas");return e.width=t,e.height=n,(e=s.call(this,e,i.settings)).width=t,e.height=n,e.parent=i,e.id=r,e.children=[],e.applyCanvasSize(),e}return e(o,[{key:"makeChild",value:function(){var e=new o({width:this.width,height:this.height,parent:this.parent});return this.children.push(e),e.setMinMax(this.min,this.max),e.resetView(),e}},{key:"setFlexible",value:function(){this.flexible=!0}},{key:"collapse",value:function(){this.collapsed=!0,this.clear()}},{key:"expand",value:function(){this.collapsed=!1}},{key:"setSettingsOverrides",value:function(t){this.setSettings(v(this.settings,t)),this.children.forEach(function(e){return e.setSettingsOverrides(t)})}},{key:"resize",value:function(e,t){var n=e.width,i=e.height,r=e.position,e=c(h(o.prototype),"resize",this).call(this,n,i);!t&&e&&this.parent.recalcChildrenSizes(),"number"==typeof r&&(this.position=r),this.children.forEach(function(e){return e.resize({width:n,height:i,position:r})})}},{key:"setMinMax",value:function(t,n){c(h(o.prototype),"setMinMax",this).call(this,t,n),this.children.forEach(function(e){return e.setMinMax(t,n)})}},{key:"setSettings",value:function(t){c(h(o.prototype),"setSettings",this).call(this,t),this.children&&this.children.forEach(function(e){return e.setSettings(t)})}},{key:"tryToChangePosition",value:function(e){this.parent.tryToChangePosition(e)}},{key:"recalcMinMax",value:function(){this.parent.calcMinMax()}},{key:"getTimeUnits",value:function(){return this.parent.getTimeUnits()}},{key:"getAccuracy",value:function(){return this.parent.timeGrid.accuracy}},{key:"renderTimeGrid",value:function(){this.parent.timeGrid.renderLines(0,this.height,this)}},{key:"renderTimeGridTimes",value:function(){this.parent.timeGrid.renderTimes(this)}},{key:"standardRender",value:function(){this.resolveRectRenderQueue(),this.resolveTextRenderQueue(),this.resolveStrokeRenderQueue(),this.renderTimeGrid()}},{key:"renderTooltipFromData",value:function(e,t){this.parent.renderTooltipFromData(e,t)}},{key:"resetParentView",value:function(){this.parent.resetView(),this.parent.render()}},{key:"render",value:function(){this.parent.partialRender(this.id)}}]),o}(),U=function(){a(r,X);var i=u(r);function r(e,t,n){return y(this,r),(e=i.call(this,e,t)).plugins=n,e.children=[],e.requestedRenders=[],e.timeGrid=new E(l(e),t),e}return e(r,[{key:"makeInstance",value:function(){var e=new G({width:this.width,height:0,id:this.children.length,parent:this,settings:this.settings});return e.setMinMax(this.min,this.max),e.resetView(),this.children.push(e),e}},{key:"calcMinMax",value:function(){var e=this.plugins.map(function(e){return e.min}).filter(p).reduce(function(e,t){return Math.min(e,t)}),t=this.plugins.map(function(e){return e.max}).filter(p).reduce(function(e,t){return Math.max(e,t)});this.setMinMax(e,t)}},{key:"calcTimeGrid",value:function(){this.timeGrid.recalc()}},{key:"setMinMax",value:function(t,n){c(h(r.prototype),"setMinMax",this).call(this,t,n),this.children.forEach(function(e){return e.setMinMax(t,n)})}},{key:"setSettings",value:function(t){c(h(r.prototype),"setSettings",this).call(this,t),this.settings=t,this.timeGrid&&this.timeGrid.setSettings(t),this.children&&(this.children.forEach(function(e){return e.setSettings(t)}),this.plugins.forEach(function(e){return e.setSettings&&e.setSettings(t)}),this.recalcChildrenSizes())}},{key:"resize",value:function(e,t){var n=this.width;c(h(r.prototype),"resize",this).call(this,e,t),this.recalcChildrenSizes(),this.getInitialZoom()>this.zoom?this.resetView():this.positionX>this.min&&this.tryToChangePosition(-this.pixelToTime((e-n)/2))}},{key:"recalcChildrenSizes",value:function(){var n=this.getChildrenSizes();this.freeSpace=n.reduce(function(e,t){return e-t.height},this.height),this.children.forEach(function(e,t){e.resize(n[t],!0)})}},{key:"getChildrenSizes",value:function(){var o=this,e=this.children.map(function(e,t){return t}).map(function(e){var t=o.plugins[e];return o.children[e].flexible&&t.height?"flexibleStatic":t.height?"static":"flexibleGrowing"}),t=e.reduce(function(e,t,n){var i=o.plugins[n],r=o.children[n];return r.collapsed?e:"flexibleGrowing"===t?e-(r.height||0):"flexibleStatic"===t?e-(r.height||i.height):"static"===t?e-o.plugins[n].height:e},this.height),n=e.filter(function(e){return"flexibleGrowing"===e}).length,a=Math.floor(t/n);return e.reduce(function(e,t,n){var i,r=o.children[n],s=o.plugins[n];if(r.collapsed)i=0;else switch(t){case"static":i=s.height;break;case"flexibleGrowing":i=(r.height||0)+a;break;case"flexibleStatic":i=r.height||o.plugins[n].height}return e.result.push({width:o.width,position:e.position,height:i}),e.position+=i,e},{position:0,result:[]}).result}},{key:"getAccuracy",value:function(){return this.timeGrid.accuracy}},{key:"setZoom",value:function(t){return(this.getAccuracy()<6||t<=this.zoom)&&(c(h(r.prototype),"setZoom",this).call(this,t),this.children.forEach(function(e){return e.setZoom(t)}),!0)}},{key:"setPositionX",value:function(t){var e=c(h(r.prototype),"setPositionX",this).call(this,t);return this.children.forEach(function(e){return e.setPositionX(t)}),e}},{key:"renderPlugin",value:function(e){var t=this.plugins[e],e=this.children[e];e.clear(),e.collapsed||t.render()||e.standardRender()}},{key:"partialRender",value:function(e){var t=this;"number"==typeof e&&this.requestedRenders.push(e),this.lastPartialAnimationFrame||(this.lastPartialAnimationFrame=requestAnimationFrame(function(){t.requestedRenders.forEach(function(e){return t.renderPlugin(e)}),t.shallowRender(),t.requestedRenders=[],t.lastPartialAnimationFrame=null}))}},{key:"shallowRender",value:function(){var t=this;this.clear(),this.timeGrid.renderLines(this.height-this.freeSpace,this.freeSpace),this.children.forEach(function(e){e.collapsed||t.copy(e)}),this.plugins.forEach(function(e){e.postRender&&e.postRender(),e.renderTooltip&&e.renderTooltip()})}},{key:"render",value:function(){var n=this;cancelAnimationFrame(this.lastPartialAnimationFrame),this.requestedRenders=[],this.lastPartialAnimationFrame=null,this.lastGlobalAnimationFrame||(this.lastGlobalAnimationFrame=requestAnimationFrame(function(){n.timeGrid.recalc(),n.children.forEach(function(e,t){return n.renderPlugin(t)}),n.shallowRender(),n.lastGlobalAnimationFrame=null}))}}]),r}(),_=function(){a(r,x);var i=u(r);function r(e,t){var n;return y(this,r),(n=i.call(this)).renderEngine=t,n.canvas=e,n.hitRegions=[],n.instances=[],n.mouse={x:0,y:0},n.handleMouseWheel=n.handleMouseWheel.bind(l(n)),n.handleMouseDown=n.handleMouseDown.bind(l(n)),n.handleMouseUp=n.handleMouseUp.bind(l(n)),n.handleMouseMove=n.handleMouseMove.bind(l(n)),n.initListeners(),n.reset(),n}return e(r,[{key:"makeInstance",value:function(e){e=new B(this,e);return this.instances.push(e),e}},{key:"reset",value:function(){this.selectedRegion=null,this.hoveredRegion=null,this.hitRegions=[]}},{key:"destroy",value:function(){this.removeListeners()}},{key:"initListeners",value:function(){this.canvas&&(this.canvas.addEventListener("wheel",this.handleMouseWheel),this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("mouseleave",this.handleMouseUp),this.canvas.addEventListener("mousemove",this.handleMouseMove))}},{key:"removeListeners",value:function(){this.canvas&&(this.canvas.removeEventListener("wheel",this.handleMouseWheel),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mouseup",this.handleMouseUp),this.canvas.removeEventListener("mouseleave",this.handleMouseUp),this.canvas.removeEventListener("mousemove",this.handleMouseMove))}},{key:"handleMouseWheel",value:function(e){var t=e.deltaY,n=e.deltaX;e.preventDefault();var i=this.renderEngine.getRealView(),r=this.renderEngine.getInitialZoom(),s=this.renderEngine.positionX,e=this.renderEngine.zoom,n=n/this.renderEngine.zoom,t=t/1e3*this.renderEngine.zoom;this.renderEngine.tryToChangePosition(n),0!==(t=this.renderEngine.zoom-t>=r?t:this.renderEngine.zoom-r)&&this.renderEngine.setZoom(this.renderEngine.zoom-t)&&(t=this.mouse.x/this.renderEngine.width,t=(i-this.renderEngine.width/this.renderEngine.zoom)*t,this.renderEngine.tryToChangePosition(t)),this.checkRegionHover(),s===this.renderEngine.positionX&&e===this.renderEngine.zoom||this.renderEngine.render()}},{key:"handleMouseDown",value:function(){this.moveActive=!0,this.mouseDownPosition={x:this.mouse.x,y:this.mouse.y},this.mouseDownHoveredInstance=this.hoveredInstance,this.emit("down",this.hoveredRegion,this.mouse)}},{key:"handleMouseUp",value:function(){this.moveActive=!1;var e=this.mouseDownPosition&&this.mouseDownPosition.x===this.mouse.x&&this.mouseDownPosition.y===this.mouse.y;e&&this.handleRegionHit(this.mouse.x,this.mouse.y),this.emit("up",this.hoveredRegion,this.mouse,e),e&&this.emit("click",this.hoveredRegion,this.mouse)}},{key:"handleMouseMove",value:function(e){var t,n;this.moveActive&&(t=this.mouse.y-e.offsetY,n=(this.mouse.x-e.offsetX)/this.renderEngine.zoom,(t||n)&&this.emit("change-position",{deltaX:n,deltaY:t},this.mouseDownPosition,this.mouse,this.mouseDownHoveredInstance)),this.mouse.x=e.offsetX,this.mouse.y=e.offsetY,this.checkRegionHover(),this.emit("move",this.hoveredRegion,this.mouse)}},{key:"handleRegionHit",value:function(){var e=this.getHoveredRegion();this.emit("select",e,this.mouse)}},{key:"checkRegionHover",value:function(){var e=this.getHoveredRegion(this.mouse.x,this.mouse.y);e?(!this.currentCursor&&e.cursor?this.renderEngine.canvas.style.cursor=e.cursor:this.currentCursor||this.clearCursor(),this.hoveredRegion=e,this.emit("hover",e,this.mouse),this.renderEngine.partialRender()):this.hoveredRegion&&!e&&(this.currentCursor||this.clearCursor(),this.hoveredRegion=null,this.emit("hover",null,this.mouse),this.renderEngine.partialRender())}},{key:"getHoveredRegion",value:function(){var r=this,e=this.hitRegions.find(function(e){var t=e.x,n=e.y,i=e.w,e=e.h;return r.mouse.x>=t&&r.mouse.x<=t+i&&r.mouse.y>=n&&r.mouse.y<=n+e});if(e)return e;e=this.instances.find(function(e){e=e.renderEngine;return e.position<=r.mouse.y&&e.height+e.position>=r.mouse.y});if(this.hoveredInstance=e){var s=e.renderEngine.position;return e.hitRegions.find(function(e){var t=e.x,n=e.y,i=e.w,e=e.h;return r.mouse.x>=t&&r.mouse.x<=t+i&&r.mouse.y>=n+s&&r.mouse.y<=n+e+s})}}},{key:"clearHitRegions",value:function(){this.hitRegions=[]}},{key:"addHitRegion",value:function(e,t,n,i,r,s,o){this.hitRegions.push({type:e,data:t,x:n,y:i,w:r,h:s,cursor:o})}},{key:"setCursor",value:function(e){this.renderEngine.canvas.style.cursor=e,this.currentCursor=e}},{key:"clearCursor",value:function(){var e=this.getHoveredRegion(this.mouse.x,this.mouse.y);this.currentCursor=null,e&&e.cursor?this.renderEngine.canvas.style.cursor=e.cursor:this.renderEngine.canvas.style.cursor=null}}]),r}(),B=function(){a(i,x);var n=u(i);function i(e,t){var r;return y(this,i),(r=n.call(this)).parent=e,(r.renderEngine=t).on("clear",function(){return r.clearHitRegions()}),["down","up","move","click","select"].forEach(function(i){return e.on(i,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.resend.apply(r,[i].concat(t))})}),["hover"].forEach(function(i){return e.on(i,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.emit.apply(r,[i].concat(t))})}),e.on("change-position",function(e,t,n,i){i===l(r)&&r.emit("change-position",e,t,n)}),r.clearHitRegions(),r}return e(i,[{key:"resend",value:function(){this.renderEngine.position<=this.parent.mouse.y&&this.renderEngine.height+this.renderEngine.position>=this.parent.mouse.y&&this.emit.apply(this,arguments)}},{key:"getMouse",value:function(){var e=this.parent.mouse;return{x:e.x,y:e.y-this.renderEngine.position}}},{key:"getGlobalMouse",value:function(){return this.parent.mouse}},{key:"clearHitRegions",value:function(){this.hitRegions=[]}},{key:"addHitRegion",value:function(e,t,n,i,r,s,o){this.hitRegions.push({type:e,data:t,x:n,y:i,w:r,h:s,cursor:o})}},{key:"setCursor",value:function(e){this.parent.setCursor(e)}},{key:"clearCursor",value:function(){this.parent.clearCursor()}}]),i}(),N=function(){a(o,x);var s=u(o);function o(e){var t,n=e.canvas,i=e.plugins,e=e.settings;y(this,o),(t=s.call(this)).renderEngine=new U(n,e,i),t.interactionsEngine=new _(n,t.renderEngine),t.plugins=i;var r=Array(t.plugins.length).fill(null).map(function(){var e=t.renderEngine.makeInstance();return{renderEngine:e,interactionsEngine:t.interactionsEngine.makeInstance(e)}});return t.plugins.forEach(function(e,t){e.init(r[t].renderEngine,r[t].interactionsEngine)}),t.renderEngine.calcMinMax(),t.renderEngine.resetView(),t.renderEngine.recalcChildrenSizes(),t.renderEngine.calcTimeGrid(),t.plugins.forEach(function(e){return e.postInit&&e.postInit()}),t.renderEngine.render(),t}return e(o,[{key:"render",value:function(){this.renderEngine.render()}},{key:"resize",value:function(e,t){this.renderEngine.resize(e,t),this.renderEngine.render()}},{key:"execOnPlugins",value:function(e){for(var t,n=0,i=arguments.length,r=new Array(1<i?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];for(;n<this.plugins.length;)this.plugins[n][e]&&(t=this.plugins[n])[e].apply(t,r),n++}},{key:"setSettings",value:function(e){this.renderEngine.setSettings(e),this.renderEngine.render()}},{key:"setZoom",value:function(e,t){t=this.renderEngine.width/(t-e);this.renderEngine.setPositionX(e),this.renderEngine.setZoom(t),this.renderEngine.render()}}]),o}();function Q(e){var t={exports:{}};return e(t,t.exports),t.exports}var Y={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},K=Q(function(e){var o=Array.prototype.concat,a=Array.prototype.slice,t=e.exports=function(e){for(var t,n=[],i=0,r=e.length;i<r;i++){var s=e[i];(t=s)&&"string"!=typeof t&&(t instanceof Array||Array.isArray(t)||0<=t.length&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))?n=o.call(n,a.call(s)):n.push(s)}return n};t.wrap=function(e){return function(){return e(t(arguments))}}}),q=Q(function(e){var t,n={};for(t in Y)Y.hasOwnProperty(t)&&(n[Y[t]]=t);var i=e.exports={to:{},get:{}};function o(e,t,n){return Math.min(Math.max(t,e),n)}function r(e){e=e.toString(16).toUpperCase();return e.length<2?"0"+e:e}i.get=function(e){var t,n;switch(e.substring(0,3).toLowerCase()){case"hsl":t=i.get.hsl(e),n="hsl";break;case"hwb":t=i.get.hwb(e),n="hwb";break;default:t=i.get.rgb(e),n="rgb"}return t?{model:n,value:t}:null},i.get.rgb=function(e){if(!e)return null;var t,n,i,r=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=t[2],t=t[1],n=0;n<3;n++){var s=2*n;r[n]=parseInt(t.slice(s,2+s),16)}i&&(r[3]=parseInt(i,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(i=(t=t[1])[3],n=0;n<3;n++)r[n]=parseInt(t[n]+t[n],16);i&&(r[3]=parseInt(i+i,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(n=0;n<3;n++)r[n]=parseInt(t[n+1],0);t[4]&&(r[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(t=e.match(/(\D+)/))?"transparent"===t[1]?[0,0,0,0]:(r=Y[t[1]])?(r[3]=1,r):null:null;for(n=0;n<3;n++)r[n]=Math.round(2.55*parseFloat(t[n+1]));t[4]&&(r[3]=parseFloat(t[4]))}for(n=0;n<3;n++)r[n]=o(r[n],0,255);return r[3]=o(r[3],0,1),r},i.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){e=parseFloat(t[4]);return[(parseFloat(t[1])+360)%360,o(parseFloat(t[2]),0,100),o(parseFloat(t[3]),0,100),o(isNaN(e)?1:e,0,1)]}return null},i.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){e=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,o(parseFloat(t[2]),0,100),o(parseFloat(t[3]),0,100),o(isNaN(e)?1:e,0,1)]}return null},i.to.hex=function(){var e=K(arguments);return"#"+r(e[0])+r(e[1])+r(e[2])+(e[3]<1?r(Math.round(255*e[3])):"")},i.to.rgb=function(){var e=K(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},i.to.rgb.percent=function(){var e=K(arguments),t=Math.round(e[0]/255*100),n=Math.round(e[1]/255*100),i=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+t+"%, "+n+"%, "+i+"%)":"rgba("+t+"%, "+n+"%, "+i+"%, "+e[3]+")"},i.to.hsl=function(){var e=K(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},i.to.hwb=function(){var e=K(arguments),t="";return 4<=e.length&&1!==e[3]&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},i.to.keyword=function(e){return n[e.slice(0,3)]}}),Z=Q(function(e){var t,a={};for(t in Y)Y.hasOwnProperty(t)&&(a[Y[t]]=t);var n,r=e.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(n in r)if(r.hasOwnProperty(n)){if(!("channels"in r[n]))throw new Error("missing channels property: "+n);if(!("labels"in r[n]))throw new Error("missing channel labels property: "+n);if(r[n].labels.length!==r[n].channels)throw new Error("channel and label counts mismatch: "+n);var i=r[n].channels,s=r[n].labels;delete r[n].channels,delete r[n].labels,Object.defineProperty(r[n],"channels",{value:i}),Object.defineProperty(r[n],"labels",{value:s})}r.rgb.hsl=function(e){var t,n=e[0]/255,i=e[1]/255,r=e[2]/255,s=Math.min(n,i,r),o=Math.max(n,i,r),e=o-s;return o===s?t=0:n===o?t=(i-r)/e:i===o?t=2+(r-n)/e:r===o&&(t=4+(n-i)/e),(t=Math.min(60*t,360))<0&&(t+=360),i=(s+o)/2,[t,100*(o===s?0:i<=.5?e/(o+s):e/(2-o-s)),100*i]},r.rgb.hsv=function(e){var t,n,i,r=e[0]/255,s=e[1]/255,o=e[2]/255,a=Math.max(r,s,o),h=a-Math.min(r,s,o),l=function(e){return(a-e)/6/h+.5};return 0==h?n=i=0:(i=h/a,t=l(r),e=l(s),l=l(o),r===a?n=l-e:s===a?n=1/3+t-l:o===a&&(n=2/3+e-t),n<0?n+=1:1<n&&--n),[360*n,100*i,100*a]},r.rgb.hwb=function(e){var t=e[0],n=e[1],i=e[2];return[r.rgb.hsl(e)[0],100*(1/255*Math.min(t,Math.min(n,i))),100*(i=1-1/255*Math.max(t,Math.max(n,i)))]},r.rgb.cmyk=function(e){var t=e[0]/255,n=e[1]/255,i=e[2]/255,e=Math.min(1-t,1-n,1-i);return[100*((1-t-e)/(1-e)||0),100*((1-n-e)/(1-e)||0),100*((1-i-e)/(1-e)||0),100*e]},r.rgb.keyword=function(e){var t=a[e];if(t)return t;var n,i,r,s,o=1/0;for(i in Y)Y.hasOwnProperty(i)&&(s=Y[i],r=e,s=s,(s=Math.pow(r[0]-s[0],2)+Math.pow(r[1]-s[1],2)+Math.pow(r[2]-s[2],2))<o&&(o=s,n=i));return n},r.keyword.rgb=function(e){return Y[e]},r.rgb.xyz=function(e){var t=e[0]/255,n=e[1]/255,e=e[2]/255;return[100*(.4124*(t=.04045<t?Math.pow((t+.055)/1.055,2.4):t/12.92)+.3576*(n=.04045<n?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(e=.04045<e?Math.pow((e+.055)/1.055,2.4):e/12.92)),100*(.2126*t+.7152*n+.0722*e),100*(.0193*t+.1192*n+.9505*e)]},r.rgb.lab=function(e){var t=r.rgb.xyz(e),n=t[0],e=t[1],t=t[2];return e/=100,t/=108.883,n=.008856<(n/=95.047)?Math.pow(n,1/3):7.787*n+16/116,[116*(e=.008856<e?Math.pow(e,1/3):7.787*e+16/116)-16,500*(n-e),200*(e-(t=.008856<t?Math.pow(t,1/3):7.787*t+16/116))]},r.hsl.rgb=function(e){var t,n,i=e[0]/360,r=e[1]/100,e=e[2]/100;if(0==r)return[n=255*e,n,n];for(var s,o=2*e-(s=e<.5?e*(1+r):e+r-e*r),a=[0,0,0],h=0;h<3;h++)(t=i+1/3*-(h-1))<0&&t++,1<t&&t--,n=6*t<1?o+6*(s-o)*t:2*t<1?s:3*t<2?o+(s-o)*(2/3-t)*6:o,a[h]=255*n;return a},r.hsl.hsv=function(e){var t=e[0],n=e[1]/100,i=e[2]/100,r=n,e=Math.max(i,.01);return n*=(i*=2)<=1?i:2-i,r*=e<=1?e:2-e,[t,100*(0==i?2*r/(e+r):2*n/(i+n)),100*((i+n)/2)]},r.hsv.rgb=function(e){var t=e[0]/60,n=e[1]/100,i=e[2]/100,e=Math.floor(t)%6,t=t-Math.floor(t),r=255*i*(1-n),s=255*i*(1-n*t),o=255*i*(1-n*(1-t));switch(i*=255,e){case 0:return[i,o,r];case 1:return[s,i,r];case 2:return[r,i,o];case 3:return[r,s,i];case 4:return[o,r,i];case 5:return[i,r,s]}},r.hsv.hsl=function(e){var t=e[0],n=e[1]/100,i=e[2]/100,r=Math.max(i,.01),e=(2-n)*i,i=(2-n)*r,r=n*r;return[t,100*((r/=i<=1?i:2-i)||0),100*(e/=2)]},r.hwb.rgb=function(e){var t,n,i,r,s,o=e[0]/360,a=e[1]/100,h=e[2]/100,e=a+h;switch(1<e&&(a/=e,h/=e),o=6*o-(e=Math.floor(6*o)),n=a+(o=0!=(1&e)?1-o:o)*((t=1-h)-a),e){default:case 6:case 0:i=t,r=n,s=a;break;case 1:i=n,r=t,s=a;break;case 2:i=a,r=t,s=n;break;case 3:i=a,r=n,s=t;break;case 4:i=n,r=a,s=t;break;case 5:i=t,r=a,s=n}return[255*i,255*r,255*s]},r.cmyk.rgb=function(e){var t=e[0]/100,n=e[1]/100,i=e[2]/100,e=e[3]/100;return[255*(1-Math.min(1,t*(1-e)+e)),255*(1-Math.min(1,n*(1-e)+e)),255*(1-Math.min(1,i*(1-e)+e))]},r.xyz.rgb=function(e){var t=e[0]/100,n=e[1]/100,i=e[2]/100,r=3.2406*t+-1.5372*n+-.4986*i,e=-.9689*t+1.8758*n+.0415*i,i=.0557*t+-.204*n+1.057*i;return r=.0031308<r?1.055*Math.pow(r,1/2.4)-.055:12.92*r,e=.0031308<e?1.055*Math.pow(e,1/2.4)-.055:12.92*e,i=.0031308<i?1.055*Math.pow(i,1/2.4)-.055:12.92*i,[255*(r=Math.min(Math.max(0,r),1)),255*(e=Math.min(Math.max(0,e),1)),255*(i=Math.min(Math.max(0,i),1))]},r.xyz.lab=function(e){var t=e[0],n=e[1],e=e[2];return n/=100,e/=108.883,t=.008856<(t/=95.047)?Math.pow(t,1/3):7.787*t+16/116,[116*(n=.008856<n?Math.pow(n,1/3):7.787*n+16/116)-16,500*(t-n),200*(n-(e=.008856<e?Math.pow(e,1/3):7.787*e+16/116))]},r.lab.xyz=function(e){var t=(e[0]+16)/116,n=e[1]/500+t,i=t-e[2]/200,r=Math.pow(t,3),s=Math.pow(n,3),e=Math.pow(i,3);return t=.008856<r?r:(t-16/116)/7.787,n=.008856<s?s:(n-16/116)/7.787,i=.008856<e?e:(i-16/116)/7.787,[n*=95.047,t*=100,i*=108.883]},r.lab.lch=function(e){var t=e[0],n=e[1],i=e[2],e=360*Math.atan2(i,n)/2/Math.PI;return e<0&&(e+=360),[t,Math.sqrt(n*n+i*i),e]},r.lch.lab=function(e){var t=e[0],n=e[1],e=e[2]/360*2*Math.PI;return[t,n*Math.cos(e),n*Math.sin(e)]},r.rgb.ansi16=function(e){var t=e[0],n=e[1],i=e[2],e=1 in arguments?arguments[1]:r.rgb.hsv(e)[2];if(0===(e=Math.round(e/50)))return 30;t=30+(Math.round(i/255)<<2|Math.round(n/255)<<1|Math.round(t/255));return 2===e&&(t+=60),t},r.hsv.ansi16=function(e){return r.rgb.ansi16(r.hsv.rgb(e),e[2])},r.rgb.ansi256=function(e){var t=e[0],n=e[1],e=e[2];return t===n&&n===e?t<8?16:248<t?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(e/255*5)},r.ansi16.rgb=function(e){var t=e%10;if(0===t||7===t)return 50<e&&(t+=3.5),[t=t/10.5*255,t,t];e=.5*(1+~~(50<e));return[(1&t)*e*255,(t>>1&1)*e*255,(t>>2&1)*e*255]},r.ansi256.rgb=function(e){if(232<=e){var t=10*(e-232)+8;return[t,t,t]}return e-=16,[Math.floor(e/36)/5*255,Math.floor((e=e%36)/6)/5*255,e%6/5*255]},r.rgb.hex=function(e){e=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},r.hex.rgb=function(e){var t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];e=t[0];3===t[0].length&&(e=e.split("").map(function(e){return e+e}).join(""));e=parseInt(e,16);return[e>>16&255,e>>8&255,255&e]},r.rgb.hcg=function(e){var t=e[0]/255,n=e[1]/255,i=e[2]/255,r=Math.max(Math.max(t,n),i),s=Math.min(Math.min(t,n),i),e=r-s,s=e<1?s/(1-e):0,n=e<=0?0:r===t?(n-i)/e%6:r===n?2+(i-t)/e:4+(t-n)/e+4;return n/=6,[360*(n%=1),100*e,100*s]},r.hsl.hcg=function(e){var t=e[1]/100,n=e[2]/100,i=1,r=0;return(i=n<.5?2*t*n:2*t*(1-n))<1&&(r=(n-.5*i)/(1-i)),[e[0],100*i,100*r]},r.hsv.hcg=function(e){var t=e[1]/100,n=e[2]/100,t=t*n,n=t<1?(n-t)/(1-t):0;return[e[0],100*t,100*n]},r.hcg.rgb=function(e){var t=e[0]/360,n=e[1]/100,i=e[2]/100;if(0==n)return[255*i,255*i,255*i];var r=[0,0,0],e=t%1*6,s=e%1,o=1-s;switch(Math.floor(e)){case 0:r[0]=1,r[1]=s,r[2]=0;break;case 1:r[0]=o,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=s;break;case 3:r[0]=0,r[1]=o,r[2]=1;break;case 4:r[0]=s,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=o}return t=(1-n)*i,[255*(n*r[0]+t),255*(n*r[1]+t),255*(n*r[2]+t)]},r.hcg.hsv=function(e){var t=e[1]/100,n=t+e[2]/100*(1-t),t=0<n?t/n:0;return[e[0],100*t,100*n]},r.hcg.hsl=function(e){var t=e[1]/100,n=e[2]/100*(1-t)+.5*t,i=0;return 0<n&&n<.5?i=t/(2*n):.5<=n&&n<1&&(i=t/(2*(1-n))),[e[0],100*i,100*n]},r.hcg.hwb=function(e){var t=e[1]/100,n=t+e[2]/100*(1-t);return[e[0],100*(n-t),100*(1-n)]},r.hwb.hcg=function(e){var t=e[1]/100,n=1-e[2]/100,t=n-t,n=t<1?(n-t)/(1-t):0;return[e[0],100*t,100*n]},r.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},r.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},r.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},r.gray.hsl=r.gray.hsv=function(e){return[0,0,e[0]]},r.gray.hwb=function(e){return[0,100,e[0]]},r.gray.cmyk=function(e){return[0,0,0,e[0]]},r.gray.lab=function(e){return[e[0],0,0]},r.gray.hex=function(e){e=255&Math.round(e[0]/100*255),e=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(e.length)+e},r.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}});function V(e){var t=function(){for(var e={},t=Object.keys(Z),n=t.length,i=0;i<n;i++)e[t[i]]={distance:-1,parent:null};return e}(),n=[e];for(t[e].distance=0;n.length;)for(var i=n.pop(),r=Object.keys(Z[i]),s=r.length,o=0;o<s;o++){var a=r[o],h=t[a];-1===h.distance&&(h.distance=t[i].distance+1,h.parent=i,n.unshift(a))}return t}function W(e,t){for(var n=[t[e].parent,e],i=Z[t[e].parent][e],r=t[e].parent;t[r].parent;)n.unshift(t[r].parent),i=function(t,n){return function(e){return n(t(e))}}(Z[t[r].parent][r],i),r=t[r].parent;return i.conversion=n,i}var J={};function $(t){function e(e){return null==e?e:(1<arguments.length&&(e=Array.prototype.slice.call(arguments)),t(e))}return"conversion"in t&&(e.conversion=t.conversion),e}function ee(r){function e(e){if(null==e)return e;1<arguments.length&&(e=Array.prototype.slice.call(arguments));var t=r(e);if("object"==typeof t)for(var n=t.length,i=0;i<n;i++)t[i]=Math.round(t[i]);return t}return"conversion"in r&&(e.conversion=r.conversion),e}Object.keys(Z).forEach(function(n){J[n]={},Object.defineProperty(J[n],"channels",{value:Z[n].channels}),Object.defineProperty(J[n],"labels",{value:Z[n].labels});var i=function(e){for(var t=V(e),n={},i=Object.keys(t),r=i.length,s=0;s<r;s++){var o=i[s];null!==t[o].parent&&(n[o]=W(o,t))}return n}(n);Object.keys(i).forEach(function(e){var t=i[e];J[n][e]=ee(t),J[n][e].raw=$(t)})});var te=J,ne=[].slice,ie=["keyword","gray","hex"],re={};Object.keys(te).forEach(function(e){re[ne.call(te[e].labels).sort().join("")]=e});var se={};function oe(e,t){if(!(this instanceof oe))return new oe(e,t);if((t=t&&t in ie?null:t)&&!(t in te))throw new Error("Unknown model: "+t);if(null==e)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof oe)this.model=e.model,this.color=e.color.slice(),this.valpha=e.valpha;else if("string"==typeof e){var n=q.get(e);if(null===n)throw new Error("Unable to parse color from string: "+e);this.model=n.model,i=te[this.model].channels,this.color=n.value.slice(0,i),this.valpha="number"==typeof n.value[i]?n.value[i]:1}else if(e.length){this.model=t||"rgb";var i=te[this.model].channels,r=ne.call(e,0,i);this.color=le(r,i),this.valpha="number"==typeof e[i]?e[i]:1}else if("number"==typeof e)e&=16777215,this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;r=Object.keys(e);"alpha"in e&&(r.splice(r.indexOf("alpha"),1),this.valpha="number"==typeof e.alpha?e.alpha:0);r=r.sort().join("");if(!(r in re))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=re[r];for(var s=te[this.model].labels,o=[],a=0;a<s.length;a++)o.push(e[s[a]]);this.color=le(o)}if(se[this.model])for(i=te[this.model].channels,a=0;a<i;a++){var h=se[this.model][a];h&&(this.color[a]=h(this.color[a]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function ae(n,i,r){return(n=Array.isArray(n)?n:[n]).forEach(function(e){(se[e]||(se[e]=[]))[i]=r}),n=n[0],function(e){var t;return arguments.length?(r&&(e=r(e)),(t=this[n]()).color[i]=e,t):(t=this[n]().color[i],t=r?r(t):t)}}function he(t){return function(e){return Math.max(0,Math.min(t,e))}}function le(e,t){for(var n=0;n<t;n++)"number"!=typeof e[n]&&(e[n]=0);return e}function ue(e){var t="qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM",e=Te(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:4);return Array(e).fill(null).map(function(){return t[Te(t.length-1)]}).join("")}function ce(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return Math.random()*(e-t)+t}function de(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:10,i=3<arguments.length?arguments[3]:void 0,n=e?Te(Math.min(e,n),Math.min(e,t)):0,t=Array(n).fill(null).map(function(){return{children:[],parent:i}}),n=e-n;return i&&(i.children=t),{rest:n,items:t}}function ge(e,n){return n(e,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null).map(function(e){var t=e.children,e=r(e,["children"]);return o(o({},e),{},{children:ge(t,n,e)})})}function fe(e){var t=e.count,o=e.start,a=e.end,n=e.minChild,i=e.maxChild,h=e.thinning,l=e.colorsMonotony,e=e.colorsCount,i=function(e,t,n,i){for(var r=[],s=e,o=!1;0<s&&!o;)if(r.length){for(var a=r[r.length-1],h=[],l=0;l<a.length;l++)for(var u=0;u<a[l].length;u++){var c=de(s,t,n,a[l][u]),s=c.rest;h.push(c.items)}h.length?r.push(h):o=!0}else{var d=de(s,Math.min(t,1),n,i);r.push([d.items]),s=d.rest}return console.log("Total count:",r.reduce(function(e,t){return t.reduce(function(e,t){return e+t.length},e)},0)),{root:r[0][0],rest:s}}(t,n,i,null).root,u=Array(e).fill(null).map(function(){return ue(10)}),c=0,d=0,g=u[d],i=ge(i,function(e,t){var n=e.length,i=t&&t.start?t.start:o,r=t&&t.end?t.end:a,s=1<n?Array(n-1).fill(null).map(function(){return ce(i,r)}).concat(i,r).sort(function(e,t){return e-t}):[i,r];return e.forEach(function(e,t){var n=s[t+1]-s[t];l<c&&(c=0,g=u[d],++d>=u.length&&(d=0)),e.start=s[t]+ce(n,0)*(ce(h)/100),e.end=s[t+1]-ce(n,0)*(ce(h)/100),e.duration=e.end-e.start,e.name=ue(14),e.type=g,e.parent=null,c++}),e});return console.log("Data:",i),i}function ve(e,t){var n=e.name,i=e.units,r=e.value,s=void 0===(a=e.type)?"number":a,o=document.createElement("input"),e=document.createElement("label"),a=document.createElement("div"),t=(t?t+"-":"")+n;return a.classList.add("inputWrapper"),e.classList.add("inputLabel"),e.setAttribute("for",t),e.innerHTML="".concat(n).concat(i?"(".concat(i,")"):"",":"),o.id=t,o.value=r,o.classList.add("input"),o.setAttribute("type",s),a.appendChild(e),a.appendChild(o),{div:a,input:o,label:e}}oe.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(e){var t=this.model in q.to?this:this.rgb(),e=1===(t=t.round("number"==typeof e?e:1)).valpha?t.color:t.color.concat(this.valpha);return q.to[t.model](e)},percentString:function(e){e=this.rgb().round("number"==typeof e?e:1),e=1===e.valpha?e.color:e.color.concat(this.valpha);return q.to.rgb.percent(e)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var e={},t=te[this.model].channels,n=te[this.model].labels,i=0;i<t;i++)e[n[i]]=this.color[i];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray:function(){var e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject:function(){var e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round:function(e){return e=Math.max(e||0,0),new oe(this.color.map((n=e,function(e){return t=n,Number(e.toFixed(t));var t})).concat(this.valpha),this.model);var n},alpha:function(e){return arguments.length?new oe(this.color.concat(Math.max(0,Math.min(1,e))),this.model):this.valpha},red:ae("rgb",0,he(255)),green:ae("rgb",1,he(255)),blue:ae("rgb",2,he(255)),hue:ae(["hsl","hsv","hsl","hwb","hcg"],0,function(e){return(e%360+360)%360}),saturationl:ae("hsl",1,he(100)),lightness:ae("hsl",2,he(100)),saturationv:ae("hsv",1,he(100)),value:ae("hsv",2,he(100)),chroma:ae("hcg",1,he(100)),gray:ae("hcg",2,he(100)),white:ae("hwb",1,he(100)),wblack:ae("hwb",2,he(100)),cyan:ae("cmyk",0,he(100)),magenta:ae("cmyk",1,he(100)),yellow:ae("cmyk",2,he(100)),black:ae("cmyk",3,he(100)),x:ae("xyz",0,he(100)),y:ae("xyz",1,he(100)),z:ae("xyz",2,he(100)),l:ae("lab",0,he(100)),a:ae("lab",1),b:ae("lab",2),keyword:function(e){return arguments.length?new oe(e):te[this.model].keyword(this.color)},hex:function(e){return arguments.length?new oe(e):q.to.hex(this.rgb().round().color)},rgbNumber:function(){var e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity:function(){for(var e=this.rgb().color,t=[],n=0;n<e.length;n++){var i=e[n]/255;t[n]=i<=.03928?i/12.92:Math.pow((.055+i)/1.055,2.4)}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast:function(e){var t=this.luminosity(),e=e.luminosity();return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)},level:function(e){e=this.contrast(e);return 7.1<=e?"AAA":4.5<=e?"AA":""},isDark:function(){var e=this.rgb().color;return(299*e[0]+587*e[1]+114*e[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var e=this.rgb(),t=0;t<3;t++)e.color[t]=255-e.color[t];return e},lighten:function(e){var t=this.hsl();return t.color[2]+=t.color[2]*e,t},darken:function(e){var t=this.hsl();return t.color[2]-=t.color[2]*e,t},saturate:function(e){var t=this.hsl();return t.color[1]+=t.color[1]*e,t},desaturate:function(e){var t=this.hsl();return t.color[1]-=t.color[1]*e,t},whiten:function(e){var t=this.hwb();return t.color[1]+=t.color[1]*e,t},blacken:function(e){var t=this.hwb();return t.color[2]+=t.color[2]*e,t},grayscale:function(){var e=this.rgb().color,e=.3*e[0]+.59*e[1]+.11*e[2];return oe.rgb(e,e,e)},fade:function(e){return this.alpha(this.valpha-this.valpha*e)},opaquer:function(e){return this.alpha(this.valpha+this.valpha*e)},rotate:function(e){var t=this.hsl(),n=t.color[0];return n=(n=(n+e)%360)<0?360+n:n,t.color[0]=n,t},mix:function(e,t){if(!e||!e.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof e);var n=e.rgb(),i=this.rgb(),r=void 0===t?.5:t,e=2*r-1,t=n.alpha()-i.alpha(),e=(1+(e*t==-1?e:(e+t)/(1+e*t)))/2,t=1-e;return oe.rgb(e*n.red()+t*i.red(),e*n.green()+t*i.green(),e*n.blue()+t*i.blue(),n.alpha()*r+i.alpha()*(1-r))}},Object.keys(te).forEach(function(n){var i;-1===ie.indexOf(n)&&(i=te[n].channels,oe.prototype[n]=function(){if(this.model===n)return new oe(this);if(arguments.length)return new oe(arguments,n);var e,t="number"==typeof arguments[i]?i:this.valpha;return new oe((e=te[this.model][n].raw(this.color),(Array.isArray(e)?e:[e]).concat(t)),n)},oe[n]=function(e){return new oe(e="number"==typeof e?le(ne.call(arguments),i):e,n)})});var pe=oe,me=pe.hsl(180,30,70),ye=function(){a(s,x);var r=u(s);function s(e){var t=e.data,n=e.colors,i=e.customTooltip;return y(this,s),(e=r.call(this)).data=t,e.userColors=n,e.customTooltip=i,e.parseData(e.data),e.reset(),e}return e(s,[{key:"init",value:function(e,t){this.renderEngine=e,this.interactionsEngine=t,this.interactionsEngine.on("change-position",this.handlePositionChange.bind(this)),this.interactionsEngine.on("select",this.handleSelect.bind(this)),this.interactionsEngine.on("hover",this.handleHover.bind(this)),this.initData()}},{key:"handlePositionChange",value:function(e){var t=e.deltaX,n=e.deltaY,i=this.positionY,e=this.renderEngine.parent.positionX;0<=this.positionY+n?this.setPositionY(this.positionY+n):this.setPositionY(0),this.renderEngine.tryToChangePosition(t),e===this.renderEngine.parent.positionX&&i===this.positionY||this.renderEngine.parent.render()}},{key:"setPositionY",value:function(e){this.positionY=e}},{key:"reset",value:function(){this.colors={},this.lastRandomColor=me,this.positionY=0,this.selectedRegion=null}},{key:"calcMinMax",value:function(){var e=this.flatTree,t=L(e),e=t.min,t=t.max;this.min=e,this.max=t}},{key:"handleSelect",value:function(e){var t=this.interactionsEngine.getMouse(),t=e?this.findNodeInCluster(e,t):null;this.selectedRegion!==t&&(this.selectedRegion=t,this.renderEngine.render(),this.emit("select",this.selectedRegion&&this.selectedRegion.data,"flame-chart-node"))}},{key:"handleHover",value:function(e){this.hoveredRegion=this.findNodeInCluster(e)}},{key:"findNodeInCluster",value:function(e){var i=this,r=this.interactionsEngine.getMouse();if(e&&"cluster"===e.type){e=e.data.nodes.find(function(e){var t=e.level,n=e.start,e=e.duration,n=i.calcRect(n,e,t),e=n.x,t=n.y,n=n.w;return r.x>=e&&r.x<=e+n&&r.y>=t&&r.y<=t+i.renderEngine.blockHeight});if(e)return{data:e,type:"node"}}}},{key:"getColor",value:function(e,t){if(t)return t;if(this.colors[e])return this.colors[e];if(this.userColors[e]){t=new pe(this.userColors[e]);return this.colors[e]=t.rgb().toString(),this.colors[e]}return this.lastRandomColor=this.lastRandomColor.rotate(27),this.colors[e]=this.lastRandomColor.rgb().toString(),this.colors[e]}},{key:"setData",value:function(e){this.data=e,this.parseData(),this.initData(),this.reset(),this.renderEngine.recalcMinMax(),this.renderEngine.resetParentView()}},{key:"parseData",value:function(){this.flatTree=T(this.data),this.calcMinMax()}},{key:"initData",value:function(){this.metaClusterizedFlatTree=A(this.flatTree),this.initialClusterizedFlatTree=j(this.metaClusterizedFlatTree,this.renderEngine.zoom,this.min,this.max),this.reclusterizeClusteredFlatTree()}},{key:"reclusterizeClusteredFlatTree",value:function(){this.actualClusterizedFlatTree=H(this.initialClusterizedFlatTree,this.renderEngine.zoom,this.renderEngine.positionX,this.renderEngine.positionX+this.renderEngine.getRealView())}},{key:"calcRect",value:function(e,t,n){t*=this.renderEngine.zoom;return{x:this.renderEngine.timeToPosition(e),y:n*(this.renderEngine.blockHeight+1)-this.positionY,w:t<=.1?.1:3<=t?t-1:t-t/3}}},{key:"renderTooltip",value:function(){var e,t,n,i,r,s,o;if(this.hoveredRegion)return this.customTooltip?this.customTooltip(this.hoveredRegion,this.renderEngine,this.interactionsEngine.getGlobalMouse()):(e=(o=this.hoveredRegion.data).start,t=o.duration,n=o.children,r=o.name,s=this.renderEngine.getTimeUnits(),i=t-(n?n.reduce(function(e,t){return e+t.duration},0):0),o=this.renderEngine.getAccuracy()+2,r="".concat(r),s="duration: ".concat(t.toFixed(o)," ").concat(s," ").concat(n&&n.length?"(self ".concat(i.toFixed(o)," ").concat(s,")"):""),o="start: ".concat(e.toFixed(o)),this.renderEngine.renderTooltipFromData([{text:r},{text:s},{text:o}],this.interactionsEngine.getGlobalMouse())),!0}},{key:"render",value:function(){var h=this,e=this.renderEngine,s=e.width,l=e.blockHeight,o=e.height,u=e.minTextWidth;this.lastUsedColor=null,this.reclusterizeClusteredFlatTree();function t(r){return function(e){var t=e.start,n=e.duration,i=e.level,t=h.calcRect(t,n,i),n=t.x,i=t.y,t=t.w;0<n+t&&n<s&&0<i+l&&i<o&&r(e,n,i,t)}}var n,i,c=function(e,t,n,i){h.interactionsEngine.addHitRegion("cluster",e,t,n,i,l)};this.actualClusterizedFlatTree.forEach(t(function(e,t,n,i){var r=e.type,s=e.nodes,o=e.color,a=h.interactionsEngine.getMouse();a.y>=n&&a.y<=n+l&&c(e,t,n,i),.25<=i&&h.renderEngine.addRectToRenderQueue(h.getColor(r,o),t,n,i),u<=i&&1===s.length&&h.renderEngine.addTextToRenderQueue(s[0].name,t,n,i)})),this.selectedRegion&&"node"===this.selectedRegion.type&&(i=(n=this.selectedRegion.data).start,e=n.duration,n=n.level,e=(i=this.calcRect(i,e,n)).x,n=i.y,i=i.w,this.renderEngine.addStrokeToRenderQueue("green",e,n,i,this.renderEngine.blockHeight)),clearTimeout(this.renderChartTimeout),this.renderChartTimeout=setTimeout(function(){h.interactionsEngine.clearHitRegions(),h.actualClusterizedFlatTree.forEach(t(c))},16)}}]),s}(),be={styles:{timeGridPlugin:{font:"10px sans-serif",fontColor:"black"}}},Ee=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};y(this,t),this.setSettings(e)}return e(t,[{key:"setSettings",value:function(e){this.styles=v(be,e).styles.timeGridPlugin,this.renderEngine&&this.overrideEngineSettings()}},{key:"overrideEngineSettings",value:function(){this.renderEngine.setSettingsOverrides({styles:{main:this.styles}}),this.height=Math.round(this.renderEngine.charHeight+10)}},{key:"init",value:function(e){this.renderEngine=e,this.overrideEngineSettings()}},{key:"render",value:function(){return this.renderEngine.parent.timeGrid.renderTimes(this.renderEngine),this.renderEngine.parent.timeGrid.renderLines(0,this.renderEngine.height,this.renderEngine),!0}}]),t}(),ke=function(){function t(e){y(this,t),this.marks=this.prepareMarks(e),this.calcMinMax()}return e(t,[{key:"calcMinMax",value:function(){var e=this.marks;e.length&&(this.min=e.reduce(function(e,t){t=t.timestamp;return t<e?t:e},e[0].timestamp),this.max=e.reduce(function(e,t){t=t.timestamp;return e<t?t:e},e[0].timestamp))}},{key:"init",value:function(e,t){var n=this;this.renderEngine=e,this.interactionsEngine=t,this.interactionsEngine.on("hover",function(e){n.hoveredRegion=e})}},{key:"height",get:function(){return this.renderEngine.blockHeight+1}},{key:"prepareMarks",value:function(e){return e.map(function(e){var t=e.color;return o(o({},r(e,["color"])),{},{color:new pe(t).alpha(.7).rgb().toString()})}).sort(function(e,t){return e.timestamp-t.timestamp})}},{key:"setMarks",value:function(e){this.marks=this.prepareMarks(e),this.calcMinMax(),this.renderEngine.recalcMinMax(),this.renderEngine.resetParentView()}},{key:"calcMarksBlockPosition",value:function(e,t){return 0<e&&e<t?t:e}},{key:"render",value:function(){var a=this;this.marks.reduce(function(e,t){var n=t.timestamp,i=t.color,r=t.shortName,s=a.renderEngine.ctx.measureText(r).width,o=s+2*a.renderEngine.blockPaddingLeftRight,n=a.renderEngine.timeToPosition(n),s=a.calcMarksBlockPosition(n,e,s);return a.renderEngine.addRectToRenderQueue(i,s,0,o),a.renderEngine.addTextToRenderQueue(r,s,0,o),a.interactionsEngine.addHitRegion("timestamp",t,s,0,o,a.renderEngine.blockHeight),s+o},0)}},{key:"postRender",value:function(){var n=this;this.marks.forEach(function(e){var t=e.timestamp,e=e.color,t=n.renderEngine.timeToPosition(t);n.renderEngine.parent.setStrokeColor(e),n.renderEngine.parent.ctx.beginPath(),n.renderEngine.parent.ctx.setLineDash([8,7]),n.renderEngine.parent.ctx.moveTo(t,n.renderEngine.position),n.renderEngine.parent.ctx.lineTo(t,n.renderEngine.parent.height),n.renderEngine.parent.ctx.stroke()})}},{key:"renderTooltip",value:function(){if(this.hoveredRegion&&"timestamp"===this.hoveredRegion.type){var e=this.hoveredRegion.data,t=e.fullName,n=e.timestamp,e=this.renderEngine.getAccuracy()+2,t="".concat(t),e="".concat(n.toFixed(e)," ").concat(this.renderEngine.timeUnits);return this.renderEngine.renderTooltipFromData([{text:t},{text:e}],this.interactionsEngine.getGlobalMouse()),!0}}}]),t}(),xe={styles:{timeframeSelectorPlugin:{font:"9px sans-serif",fontColor:"black",overlayColor:"rgba(112, 112, 112, 0.5)",graphStrokeColor:"rgb(0, 0, 0, 0.2)",graphFillColor:"rgb(0, 0, 0, 0.25)",bottomLineColor:"rgb(0, 0, 0, 0.25)",knobColor:"rgb(131, 131, 131)",knobSize:6,height:60,backgroundColor:"white"}}},we=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};y(this,n),this.data=e,this.settings=t,this.shouldRender=!0}return e(n,[{key:"init",value:function(e,t){this.renderEngine=e,this.interactionsEngine=t,this.interactionsEngine.on("down",this.handleMouseDown.bind(this)),this.interactionsEngine.on("up",this.handleMouseUp.bind(this)),this.interactionsEngine.on("move",this.handleMouseMove.bind(this)),this.setSettings(this.settings)}},{key:"handleMouseDown",value:function(e,t){e&&("timeframeKnob"===e.type?("left"===e.data?this.leftKnobMoving=!0:this.rightKnobMoving=!0,this.interactionsEngine.setCursor("ew-resize")):"timeframeArea"===e.type&&(this.selectingActive=!0,this.startSelectingPosition=t.x))}},{key:"handleMouseUp",value:function(e,t,n){var i,r=this,s=!1;this.timeout&&(s=!0),clearTimeout(this.timeout),this.timeout=setTimeout(function(){return r.timeout=null},300),this.leftKnobMoving=!1,this.rightKnobMoving=!1,this.interactionsEngine.clearCursor(),this.selectingActive&&!n&&this.applyChanges(),this.selectingActive=!1,n&&!s&&(i=this.getRightKnobPosition(),n=this.getLeftKnobPosition(),t.x>i||t.x>n&&t.x<i&&t.x-n>i-t.x?this.setRightKnobPosition(t.x):this.setLeftKnobPosition(t.x),this.applyChanges()),s&&(this.renderEngine.parent.setZoom(this.renderEngine.getInitialZoom()),this.renderEngine.parent.setPositionX(this.renderEngine.min),this.renderEngine.parent.render())}},{key:"handleMouseMove",value:function(e,t){this.leftKnobMoving&&(this.setLeftKnobPosition(t.x),this.applyChanges()),this.rightKnobMoving&&(this.setRightKnobPosition(t.x),this.applyChanges()),this.selectingActive&&(this.startSelectingPosition>=t.x?(this.setLeftKnobPosition(t.x),this.setRightKnobPosition(this.startSelectingPosition)):(this.setRightKnobPosition(t.x),this.setLeftKnobPosition(this.startSelectingPosition)),this.renderEngine.render())}},{key:"postInit",value:function(){var e=this;this.offscreenRenderEngine=this.renderEngine.makeChild(),this.offscreenRenderEngine.setSettingsOverrides({styles:{main:this.styles}}),this.timeGrid=new E(this.offscreenRenderEngine,this.settings),this.offscreenRenderEngine.on("resize",function(){e.offscreenRenderEngine.setZoom(e.renderEngine.getInitialZoom()),e.offscreenRender()}),this.offscreenRenderEngine.on("min-max-change",function(){return e.shouldRender=!0}),this.setData(this.data)}},{key:"setLeftKnobPosition",value:function(e){var t;e<this.getRightKnobPosition()-1&&(t=this.renderEngine.getRealView(),e=this.renderEngine.setPositionX(this.offscreenRenderEngine.pixelToTime(e)+this.renderEngine.min),e=this.renderEngine.width/(t-e),this.renderEngine.setZoom(e))}},{key:"setRightKnobPosition",value:function(e){var t;this.getLeftKnobPosition()+1<e&&(t=this.renderEngine.getRealView(),e=this.renderEngine.positionX+t-(this.offscreenRenderEngine.pixelToTime(e)+this.renderEngine.min),e=this.renderEngine.width/(t-e),this.renderEngine.setZoom(e))}},{key:"getLeftKnobPosition",value:function(){return(this.renderEngine.positionX-this.renderEngine.min)*this.renderEngine.getInitialZoom()}},{key:"getRightKnobPosition",value:function(){return(this.renderEngine.positionX-this.renderEngine.min+this.renderEngine.getRealView())*this.renderEngine.getInitialZoom()}},{key:"applyChanges",value:function(){this.renderEngine.parent.setPositionX(this.renderEngine.positionX),this.renderEngine.parent.setZoom(this.renderEngine.zoom),this.renderEngine.parent.render()}},{key:"setSettings",value:function(e){this.settings=v(xe,e),this.styles=this.settings.styles.timeframeSelectorPlugin,this.height=this.styles.height,this.offscreenRenderEngine&&(this.offscreenRenderEngine.setSettingsOverrides({styles:{main:this.styles}}),this.timeGrid.setSettings({styles:{timeGrid:this.styles}})),this.shouldRender=!0}},{key:"setData",value:function(e){this.data=e;var r=[],t=T(this.data),n=L(t),e=n.min,n=n.max,s=0;this.min=e,this.max=n,this.clusters=A(t,function(){return!0}),this.actualClusters=j(this.clusters,this.renderEngine.zoom,this.min,this.max,2,1/0),this.actualClusterizedFlatTree=H(this.actualClusters,this.renderEngine.zoom,this.min,this.max,2,1/0).sort(function(e,t){return e.start-t.start}),this.actualClusterizedFlatTree.forEach(function(e,t){var n=e.start,i=e.end,e=e.level;s<e+1&&(s=e+1),r.push({pos:n,sort:0,level:e,index:t,type:"start"},{pos:n,sort:1,level:e+1,index:t,type:"start"},{pos:i,sort:2,level:e+1,index:t,type:"end"},{pos:i,sort:3,level:e,index:t,type:"end"})}),this.dots=r.sort(function(e,t){return e.pos!==t.pos?e.pos-t.pos:e.index===t.index?e.sort-t.sort:"start"===e.type&&"start"===t.type?e.level-t.level:"end"===e.type&&"end"===t.type?t.level-e.level:0}),this.maxLevel=s,this.offscreenRender()}},{key:"offscreenRender",value:function(){var n=this,i=this.offscreenRenderEngine.getInitialZoom();this.offscreenRenderEngine.setZoom(i),this.offscreenRenderEngine.setPositionX(this.offscreenRenderEngine.min),this.offscreenRenderEngine.clear(),this.timeGrid.recalc(),this.timeGrid.renderLines(0,this.offscreenRenderEngine.height),this.timeGrid.renderTimes(),this.offscreenRenderEngine.setStrokeColor(this.styles.graphStrokeColor),this.offscreenRenderEngine.setCtxColor(this.styles.graphFillColor),this.offscreenRenderEngine.ctx.beginPath();var r=(this.height-this.renderEngine.charHeight-4)/this.maxLevel;this.dots.length&&(this.offscreenRenderEngine.ctx.moveTo((this.dots[0].pos-this.offscreenRenderEngine.min)*i,this.castLevelToHeight(this.dots[0].level,r)),this.dots.forEach(function(e){var t=e.pos,e=e.level;n.offscreenRenderEngine.ctx.lineTo((t-n.offscreenRenderEngine.min)*i,n.castLevelToHeight(e,r))})),this.offscreenRenderEngine.ctx.closePath(),this.offscreenRenderEngine.ctx.stroke(),this.offscreenRenderEngine.ctx.fill(),this.offscreenRenderEngine.setCtxColor(this.styles.bottomLineColor),this.offscreenRenderEngine.ctx.fillRect(0,this.height-1,this.offscreenRenderEngine.width,1)}},{key:"castLevelToHeight",value:function(e,t){return this.height-e*t}},{key:"renderTimeframe",value:function(){var e=this.renderEngine.positionX-this.renderEngine.min,t=e*this.renderEngine.getInitialZoom(),n=(e+this.renderEngine.getRealView())*this.renderEngine.getInitialZoom(),i=t-this.styles.knobSize/2,r=n-this.styles.knobSize/2,e=this.renderEngine.height/3;this.renderEngine.setCtxColor(this.styles.overlayColor),this.renderEngine.fillRect(0,0,t,this.renderEngine.height),this.renderEngine.fillRect(n,0,this.renderEngine.width-n,this.renderEngine.height),this.renderEngine.setCtxColor(this.styles.overlayColor),this.renderEngine.fillRect(t-1,0,1,this.renderEngine.height),this.renderEngine.fillRect(1+n,0,1,this.renderEngine.height),this.renderEngine.setCtxColor(this.styles.knobColor),this.renderEngine.fillRect(i,0,this.styles.knobSize,e),this.renderEngine.fillRect(r,0,this.styles.knobSize,e),this.renderEngine.renderStroke("white",i,0,this.styles.knobSize,e),this.renderEngine.renderStroke("white",r,0,this.styles.knobSize,e),this.interactionsEngine.addHitRegion("timeframeKnob","left",i,0,this.styles.knobSize,e,"ew-resize"),this.interactionsEngine.addHitRegion("timeframeKnob","right",r,0,this.styles.knobSize,e,"ew-resize"),this.interactionsEngine.addHitRegion("timeframeArea",null,0,0,this.renderEngine.width,this.renderEngine.height,"text")}},{key:"render",value:function(){return this.shouldRender&&(this.shouldRender=!1,this.offscreenRender()),this.renderEngine.copy(this.offscreenRenderEngine),this.renderTimeframe(),!0}}]),n}(),Re={styles:{waterfallPlugin:{defaultHeight:68}}},Me=function(){a(s,x);var r=u(s);function s(e){var t=e.items,n=e.intervals,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return y(this,s),(e=r.call(this)).setData({items:t,intervals:n}),e.setSettings(i),e}return e(s,[{key:"init",value:function(e,t){this.renderEngine=e,this.interactionsEngine=t,this.interactionsEngine.on("change-position",this.handlePositionChange.bind(this)),this.interactionsEngine.on("hover",this.handleHover.bind(this)),this.interactionsEngine.on("select",this.handleSelect.bind(this))}},{key:"handlePositionChange",value:function(e){var t=e.deltaX,n=e.deltaY,i=this.positionY,e=this.renderEngine.parent.positionX;0<=this.positionY+n?this.setPositionY(this.positionY+n):this.setPositionY(0),this.renderEngine.tryToChangePosition(t),e===this.renderEngine.parent.positionX&&i===this.positionY||this.renderEngine.parent.render()}},{key:"handleHover",value:function(e){this.hoveredRegion=e}},{key:"handleSelect",value:function(e){e&&"waterfall-node"===e.type?(this.selectedRegion=e,this.emit("select",this.initialData[e.data],"waterfall-node"),this.renderEngine.render()):this.selectedRegion&&!e&&(this.selectedRegion=null,this.emit("select",null,"waterfall-node"),this.renderEngine.render())}},{key:"setPositionY",value:function(e){this.positionY=e}},{key:"setSettings",value:function(e){this.settings=v(Re,e),this.styles=this.settings.styles.waterfallPlugin,this.height=this.styles.defaultHeight,this.positionY=0}},{key:"setData",value:function(e){var t=e.items,a=e.intervals;this.positionY=0,this.initialData=t,this.data=t.map(function(e,t){var n=e.name,i=e.intervals,s=e.timing,r=Object.values(s),o=r.reduce(function(e,t){return Math.min(e,t)}),e=r.reduce(function(e,t){return Math.max(e,t)}),r=("string"==typeof i?a[i]:i).map(function(e){var t=e.start,n=e.end,i=e.color,r=e.type,e=e.name;return{start:"string"==typeof t?s[t]:t,end:"string"==typeof n?s[n]:n,color:i,name:e,type:r}}),i=r.filter(function(e){return"block"===e.type});return{intervals:r,textBlock:{min:i.reduce(function(e,t){t=t.start;return Math.min(e,t)},i[0].start),max:i.reduce(function(e,t){t=t.end;return Math.max(e,t)},i[0].end)},name:n,timing:s,min:o,max:e,index:t}}).sort(function(e,t){return e.min-t.min||t.max-e.max}),t.length&&(this.min=this.data.reduce(function(e,t){t=t.min;return Math.min(e,t)},this.data[0].min),this.max=this.data.reduce(function(e,t){t=t.max;return Math.max(e,t)},this.data[0].max)),this.renderEngine&&(this.renderEngine.recalcMinMax(),this.renderEngine.resetParentView())}},{key:"calcRect",value:function(e,t,n){t*=this.renderEngine.zoom;return{x:this.renderEngine.timeToPosition(e),w:n?t<=.1?.1:3<=t?t-1:t-t/3:t}}},{key:"renderTooltip",value:function(){if(this.hoveredRegion&&"waterfall-node"===this.hoveredRegion.type){var e=this.hoveredRegion.data,t=this.data[e],n=t.name,i=t.intervals,r=t.timing,s=this.renderEngine.getTimeUnits(),o=this.renderEngine.getAccuracy()+2,e={text:"".concat(n)},t={text:"intervals",color:this.renderEngine.styles.tooltipHeaderFontColor},n=i.map(function(e){var t=e.name,n=e.start,e=e.end;return{text:"".concat(t,": ").concat((e-n).toFixed(o)," ").concat(s)}}),i={text:"timing",color:this.renderEngine.styles.tooltipHeaderFontColor},r=Object.entries(r).map(function(e){var t=d(e,2),e=t[0],t=t[1];return{text:"".concat(e,": ").concat(t.toFixed(o)," ").concat(s)}});return this.renderEngine.renderTooltipFromData([e,t].concat(b(n),[i],b(r)),this.interactionsEngine.getGlobalMouse()),!0}}},{key:"render",value:function(){var h=this,n=this.renderEngine.positionX+this.renderEngine.getRealView(),i=this.renderEngine.positionX,r=this.renderEngine.blockHeight+1,s=[];this.data.filter(function(e){var t=e.min,e=e.max;return!(n<t&&n<e||e<i&&t<n)}).map(function(e){for(;s.length&&0<e.min-s[s.length-1].max;)s.pop();var t=s.length,t=o(o({},e),{},{level:t});return s.push(e),t}).forEach(function(e){var t=e.name,o=e.intervals,n=e.textBlock,i=e.level,e=e.index,a=i*r-h.positionY;0<=a+r&&a-r<=h.renderEngine.height&&(i=h.renderEngine.timeToPosition(n.min),n=h.renderEngine.timeToPosition(n.max),h.renderEngine.addTextToRenderQueue(t,i,a,n-i),i=(n=o.reduce(function(e,t,n){var i=t.color,r=t.start,s=t.end,t=t.type,r=h.calcRect(r,s-r,n===o.length-1),n=r.x,r=r.w;return"block"===t&&h.renderEngine.addRectToRenderQueue(i,n,a,r),{x:null===e.x?n:e.x,w:r+e.w}},{x:null,w:0})).x,n=n.w,h.selectedRegion&&"waterfall-node"===h.selectedRegion.type&&h.selectedRegion.data===e&&h.renderEngine.addStrokeToRenderQueue("green",i,a,n,h.renderEngine.blockHeight),h.interactionsEngine.addHitRegion("waterfall-node",e,i,a,n,h.renderEngine.blockHeight))},0)}}]),s}(),Ce={styles:{togglePlugin:{height:16,color:"rgb(202,202,202, 0.25)",strokeColor:"rgb(138,138,138, 0.50)",dotsColor:"rgb(97,97,97)",fontColor:"black",font:"10px sans-serif",triangleWidth:10,triangleHeight:7,leftPadding:10}}},Se=function(){function n(e,t){y(this,n),this.setSettings(t),this.title=e}return e(n,[{key:"setSettings",value:function(e){this.settings=v(Ce,e),this.styles=this.settings.styles.togglePlugin,this.height=this.styles.height+1}},{key:"init",value:function(e,t){var n=this;this.renderEngine=e,this.interactionsEngine=t,this.getNextEngine().setFlexible(),this.interactionsEngine.on("click",function(e){e&&"toggle"===e.type&&e.data===n.renderEngine.id&&((e=n.getNextEngine()).collapsed?e.expand():e.collapse(),n.renderEngine.parent.recalcChildrenSizes(),n.renderEngine.parent.render())}),this.interactionsEngine.on("down",function(e){e&&"knob-resize"===e.type&&e.data===n.renderEngine.id&&(e=n.getPrevEngine(),n.interactionsEngine.setCursor("row-resize"),n.resizeActive=!0,n.resizeStartHeight=e.height,n.resizeStartPosition=n.interactionsEngine.getGlobalMouse().y)}),this.interactionsEngine.parent.on("move",function(){var e,t;n.resizeActive&&(e=n.getPrevEngine(),t=n.interactionsEngine.getGlobalMouse(),e.flexible&&((t=n.resizeStartHeight-(n.resizeStartPosition-t.y))<=0?(e.collapse(),e.resize({height:0})):(e.collapsed&&e.expand(),e.resize({height:t})),n.renderEngine.parent.render()))}),this.interactionsEngine.parent.on("up",function(){n.interactionsEngine.clearCursor(),n.resizeActive=!1})}},{key:"getPrevEngine",value:function(){return this.renderEngine.parent.children[this.renderEngine.id-1]}},{key:"getNextEngine",value:function(){return this.renderEngine.parent.children[this.renderEngine.id+1]}},{key:"render",value:function(){var e=this.getNextEngine(),t=this.getPrevEngine(),n=this.styles.leftPadding+this.styles.triangleWidth,i=this.renderEngine.width/2,r=this.styles.height/2;this.renderEngine.setCtxFont(this.styles.font),this.renderEngine.setCtxColor(this.styles.color),this.renderEngine.setStrokeColor(this.styles.strokeColor),this.renderEngine.fillRect(0,0,this.renderEngine.width,this.styles.height),this.renderEngine.setCtxColor(this.styles.fontColor),this.renderEngine.addTextToRenderQueue(this.title,n,0,this.renderEngine.width),this.renderEngine.renderTriangle("black",this.styles.leftPadding,0+this.styles.height/2,this.styles.triangleWidth,this.styles.triangleHeight,e.collapsed?"right":"bottom");n=this.renderEngine.ctx.measureText(this.title).width+n;this.interactionsEngine.addHitRegion("toggle",this.renderEngine.id,0,0,n,this.styles.height,"pointer"),t.flexible&&(this.renderEngine.renderCircle(this.styles.dotsColor,i,r,1.5),this.renderEngine.renderCircle(this.styles.dotsColor,i-10,r,1.5),this.renderEngine.renderCircle(this.styles.dotsColor,10+i,r,1.5),this.interactionsEngine.addHitRegion("knob-resize",this.renderEngine.id,n,0,this.renderEngine.width-n,this.styles.height,"row-resize"))}}]),n}(),Pe=function(){a(m,N);var p=u(m);function m(e){var n,t=e.canvas,i=e.data,r=e.marks,s=e.waterfall,o=e.colors,a=e.settings,h=void 0===a?{}:a,l=e.plugins,u=void 0===l?[]:l;y(this,m);var c,d,g,f,v=[],a=h.headers,e=(a=void 0===a?{}:a).waterfall,l=void 0===e?"waterfall":e,e=a.flameChart,a=void 0===e?"flame chart":e,e=new Ee(h);return v.push(e),r&&(c=new ke(r),v.push(c)),s&&((d=new Me(s,h)).on("select",function(e,t){return n.emit("select",e,t)}),i&&v.push(new Se(l,h)),v.push(d)),i&&(g=new we(i,h),(f=new ye({data:i,colors:o})).on("select",function(e,t){return n.emit("select",e,t)}),s&&v.push(new Se(a,h)),v.push(f),v.unshift(g)),n=p.call(this,{canvas:t,settings:h,plugins:[].concat(v,b(u))}),f&&g&&(n.setData=function(e){f.setData(e),g.setData(e)},n.setFlameChartPosition=function(e){var t=e.x,e=e.y;"number"==typeof t&&n.renderEngine.setPositionX(t),"number"==typeof e&&f.setPositionY(e),n.renderEngine.render()}),c&&(n.setMarks=function(e){c.setMarks(e)}),d&&(n.setWaterfall=function(e){d.setData(e)}),n}return m}(),Te=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return Math.round(Math.random()*(e-t))+t},Le=location.search,ze=document.getElementById("wrapper"),Oe=document.getElementById("canvas"),Ae=document.getElementById("selected-node"),je=document.getElementById("data-inputs"),He=document.getElementById("styles-inputs"),Fe=document.getElementById("update-styles-button"),De=document.getElementById("update-button"),Ie=document.getElementById("export-button"),Xe=document.getElementById("import-button"),Ge=document.getElementById("import-input"),Ue={};function _e(){var e=window.getComputedStyle(ze,null);return[parseInt(e.getPropertyValue("width")),parseInt(e.getPropertyValue("height"))-3]}function Be(){return fe(Ne.reduce(function(e,t){var n=t.name,t=t.value;return e[n]=t,e},{}))}Xe.addEventListener("click",function(){Ge.click()});var Ne=[{name:"count",value:1e5},{name:"start",value:500},{name:"end",value:5e3},{name:"minChild",value:1},{name:"maxChild",value:3},{name:"thinning",units:"%",value:12},{name:"colorsMonotony",value:40},{name:"colorsCount",value:10}],Qe=Le?[]:Be(),Ye=d(_e(),2),Ke=Ye[0],Xe=Ye[1];(Ye=Oe).width=Ke,Ye.height=Xe;var qe,Ze,Ve,We,Je,$e,et,tt,nt,it=new Pe({canvas:Ye,data:Qe,marks:[{shortName:"DCL",fullName:"DOMContentLoaded",timestamp:2e3,color:"#d7c44c"},{shortName:"LE",fullName:"LoadEvent",timestamp:2100,color:"#4fd24a"},{shortName:"TTI",fullName:"Time To Interactive",timestamp:3e3,color:"#4b7ad7"}],waterfall:{items:[{name:"foo",intervals:"default",timing:{requestStart:2050,responseStart:2500,responseEnd:2600}},{name:"bar",intervals:"default",timing:{requestStart:2120,responseStart:2180,responseEnd:2300}},{name:"bar2",intervals:"default",timing:{requestStart:2120,responseStart:2180,responseEnd:2300}},{name:"bar3",intervals:"default",timing:{requestStart:2130,responseStart:2180,responseEnd:2320}},{name:"bar4",intervals:"default",timing:{requestStart:2300,responseStart:2350,responseEnd:2400}},{name:"bar5",intervals:"default",timing:{requestStart:2500,responseStart:2520,responseEnd:2550}}],intervals:{default:[{name:"waiting",color:"rgb(207,196,152)",type:"block",start:"requestStart",end:"responseStart"},{name:"downloading",color:"rgb(207,180,81)",type:"block",start:"responseStart",end:"responseEnd"}]}},colors:{task:"#696969",event:"#a4775b"}});it.on("select",function(e){e=e?JSON.stringify(o(o({},e),{},{children:void 0,parent:void 0}),null,"  "):"",Ae.innerHTML=e}),window.addEventListener("resize",function(){it.resize.apply(it,b(_e()))}),qe=function(e){it.setSettings({styles:e})},Fe.addEventListener("click",function(){qe(Ue)}),Ze=function(){Qe=Be(),it.setData(Qe)},De.addEventListener("click",function(){De.innerHTML="Generating...",De.setAttribute("disabled","true"),setTimeout(function(){Ze(),De.removeAttribute("disabled"),De.innerHTML="Generate random tree"},1)}),Ve=function(e){Qe=JSON.parse(e),it.setData(Qe)},Ge.addEventListener("change",function(e){e.target.files[0].text().then(Ve)}),We=function(){return JSON.stringify(Qe)},Ie.addEventListener("click",function(){var e,t,n,i=We();e=i,t="data.json",n="application/json",i=document.createElement("a"),n=new Blob([e],{type:n}),i.href=URL.createObjectURL(n),i.download=t,i.click()}),Je=it,!Le||($e=Le.split("?").map(function(e){return e.split("=")}).reduce(function(e,t){var n=d(t,2),t=n[0],n=n[1];return e[t]=n,e},{})).file&&fetch(decodeURIComponent($e.file),{method:"GET",mode:"no-cors"}).then(function(e){return e.text()}).then(function(e){Je.setData(JSON.parse(e)),Je.resetView()}),Le=Ne,$e=o(o(o(o(o(o({},I.styles),m.styles),be.styles),xe.styles),Re.styles),Ce.styles),je=je,et=Le,tt=document.createDocumentFragment(),et.forEach(function(e,t){var n=ve(e),e=n.div;n.input.addEventListener("change",function(e){return et[t].value=parseInt(e.target.value)}),tt.appendChild(e)}),je.appendChild(tt),je=He,$e=$e,nt=document.createDocumentFragment(),Object.entries($e).forEach(function(e){var t=d(e,2),e=t[0],t=t[1];Ue[e]=o({},t)}),Object.entries($e).forEach(function(e){var t=d(e,2),r=t[0],e=t[1],t=document.createElement("div");t.innerHTML=r,t.classList.add("inputsTitle"),nt.appendChild(t),Object.entries(e).forEach(function(e){var t=d(e,2),n=t[0],e=t[1],i="number"==typeof e,t=ve({name:n,value:e,type:i?"number":"text"},r),e=t.input,t=t.div;e.addEventListener("change",function(e){Ue[r][n]=i?parseInt(e.target.value):e.target.value}),nt.appendChild(t)})}),je.appendChild(nt)}();
